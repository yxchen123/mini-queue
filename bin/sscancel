#!/opt/Anaconda3/2022.05/bin/python
import sys
import fcntl
from tool import parse_task_info, find_file_path

cancel_task_id = sys.argv[1]
queue_info_path = find_file_path('queue_info.dat')

with open(queue_info_path, 'r+') as f:
    fcntl.flock(f, fcntl.LOCK_EX)
    lines = f.readlines()
    parse_lines = []
    for i in lines:
        parse_lines.append(parse_task_info(i))
    for n, i in enumerate(parse_lines):
        if i['TASKID'] == cancel_task_id:
            parse_lines[n]['ST'] = 'C'
            break
    f.seek(0)
    f.truncate()
    for i in parse_lines:
        values = list(i.values())
        f.write(str(values).strip('[]').replace("'", "")+ '\n')
    
    fcntl.flock(f, fcntl.LOCK_UN)